<!DOCTYPE html>
<html lang="en">

<head>
    <script>
    (function() {
        const currentPath = window.location.pathname;
        const currentHost = window.location.host;
        
        // Specific detection for different deployments
        const isSTCDomain = currentHost === "students.iisertvm.ac.in" && currentPath.startsWith("/stc/");
        const isGitHubPages = currentHost.includes("github.io");
        const isSubdirectoryDeployment = currentPath.includes("/STC_IISERTVM/");
        
        // Determine the base path based on deployment
        let siteBasePath = "/";
        if (isSTCDomain) {
            siteBasePath = "/stc/";
        } else if (isSubdirectoryDeployment) {
            siteBasePath = "/STC_IISERTVM/";
        }
        
        function fixPath(originalPath) {
            if (!originalPath || originalPath.startsWith("http://") || originalPath.startsWith("https://") || originalPath.startsWith("//")) {
                return originalPath;
            }
            
            if (originalPath.startsWith("../")) {
                if (isSTCDomain || isSubdirectoryDeployment) {
                    const relativePath = originalPath.substring(3);
                    return siteBasePath + relativePath;
                } else {
                    return originalPath;
                }
            } else if (originalPath.startsWith("./") || (!originalPath.startsWith("/") && !originalPath.includes(":"))) {
                if (isSTCDomain || isSubdirectoryDeployment) {
                    const cleanPath = originalPath.replace("./", "");
                    return siteBasePath + "pages/" + cleanPath;
                } else {
                    return originalPath;
                }
            }
            
            return originalPath;
        }
        
        window.writeFixedCSS = function(originalPath) {
            const newPath = fixPath(originalPath);
            document.write('<link rel="stylesheet" href="' + newPath + '">');
        };
        
        window.writeFixedJS = function(originalPath) {
            const newPath = fixPath(originalPath);
            document.write('<script src="' + newPath + '"><\/script>');
        };
        
        window.writeFixedImg = function(originalPath, altText, className = '', id = '') {
            const newPath = fixPath(originalPath);
            const classAttr = className ? ' class="' + className + '"' : '';
            const idAttr = id ? ' id="' + id + '"' : '';
            document.write('<img src="' + newPath + '" alt="' + altText + '"' + classAttr + idAttr + '>');
        };
    })();
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery - STC IISER TVM</title>
    <script>writeFixedCSS("../css/style.css");</script>
    <script>writeFixedCSS("navbar.css");</script>
    <script>writeFixedCSS("gallery-enhanced.css");</script>
</head>

<body>
    <!-- navbar-->
     <div id="navbar"> </div>

    <main>
        <section class="page-header">
            <div class="container">
                <h1>Gallery</h1>
                <p>A visual journey through our events and activities.</p>
            </div>
        </section>

        <section id="gallery-page" class="container">
            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="anvesha">Anvesha</button>
                <button class="filter-btn" data-filter="crucible">Crucible</button>
                <button class="filter-btn" data-filter="national-science-day">National Science Day</button>
                <button class="filter-btn" data-filter="panel-discussion">Panel Discussion</button>
                <button class="filter-btn" data-filter="cafe-scientifique">Cafe Scientifique</button>
            </div>

            <div class="gallery-container">
                <!-- Anvesha Events -->
                <div class="gallery-item-full" data-category="anvesha">
                    <script>writeFixedImg('../images/gallery/Events/Anvesha/Inauguration/img1.webp', 'Anvesha Inauguration Ceremony');</script>
                </div>
                <div class="gallery-item-full" data-category="anvesha">
                    <script>writeFixedImg('../images/gallery/Events/Anvesha/Inauguration/img2.webp', 'Anvesha Inauguration');</script>
                </div>
                <div class="gallery-item-full" data-category="anvesha">
                    <script>writeFixedImg('../images/gallery/Events/Anvesha/Afficionados/img1.webp', 'Anvesha Afficionados Competition');</script>
                </div>
                <div class="gallery-item-full" data-category="anvesha">
                    <script>writeFixedImg('../images/gallery/Events/Anvesha/Afficionados/img2.webp', 'Afficionados Event');</script>
                </div>
                <div class="gallery-item-full" data-category="anvesha">
                    <script>writeFixedImg('../images/gallery/Events/Anvesha/Afficionados/img3.webp', 'Afficionados Competition');</script>
                </div>
                <div class="gallery-item-full" data-category="anvesha">
                    <script>writeFixedImg('../images/gallery/Events/Anvesha/Afficionados/img4.webp', 'Students at Afficionados');</script>
                </div>
                <div class="gallery-item-full" data-category="anvesha">
                    <script>writeFixedImg('../images/gallery/Events/Anvesha/Afficionados/img5.webp', 'Afficionados Winners');</script>
                </div>
                <div class="gallery-item-full" data-category="anvesha">
                    <script>writeFixedImg('../images/gallery/Events/Anvesha/Afficionados/img6.webp', 'Afficionados Award Ceremony');</script>
                </div>
                <div class="gallery-item-full" data-category="anvesha">
                    <script>writeFixedImg('../images/gallery/Events/Anvesha/Afficionados/img7.webp', 'Afficionados Group Photo');</script>
                </div>

                <div class="gallery-item-full" data-category="anvesha">
                    <script>writeFixedImg('../images/gallery/Events/Anvesha/BahFest/img1.webp', 'BahFest Presentation');</script>
                </div>

                <div class="gallery-item-full" data-category="anvesha">
                    <script>writeFixedImg('../images/gallery/Events/Anvesha/Blackbox/img1.webp', 'Blackbox Competition');</script>
                </div>
                <div class="gallery-item-full" data-category="anvesha">
                    <script>writeFixedImg('../images/gallery/Events/Anvesha/Blackbox/img2.webp', 'Blackbox Event');</script>
                </div>

                <div class="gallery-item-full" data-category="anvesha">
                    <script>writeFixedImg('../images/gallery/Events/Anvesha/Blender Workshop/img1.webp', 'Blender Workshop Session');</script>
                </div>
                <div class="gallery-item-full" data-category="anvesha">
                    <script>writeFixedImg('../images/gallery/Events/Anvesha/Blender Workshop/img2.webp', 'Blender Workshop Participants');</script>
                </div>

                <div class="gallery-item-full" data-category="anvesha">
                    <script>writeFixedImg('../images/gallery/Events/Anvesha/Entanglement/img1.webp', 'Entanglement Event');</script>
                </div>
                <div class="gallery-item-full" data-category="anvesha">
                    <script>writeFixedImg('../images/gallery/Events/Anvesha/Entanglement/img2.webp', 'Entanglement Competition');</script>
                </div>
                <div class="gallery-item-full" data-category="anvesha">
                    <script>writeFixedImg('../images/gallery/Events/Anvesha/Entanglement/img3.webp', 'Entanglement Participants');</script>
                </div>

                <div class="gallery-item-full" data-category="anvesha">
                    <script>writeFixedImg('../images/gallery/Events/Anvesha/Jigyasa/img1.webp', 'Jigyasa Event');</script>
                </div>
                <div class="gallery-item-full" data-category="anvesha">
                    <script>writeFixedImg('../images/gallery/Events/Anvesha/Utsuk/img1.webp', 'Utsuk Competition');</script>
                </div>

                <!-- Crucible Events -->
                <div class="gallery-item-full" data-category="crucible">
                    <script>writeFixedImg('../images/gallery/Events/Crucible/img6.webp', 'Crucible Optics Workshop');</script>
                </div>
                <div class="gallery-item-full" data-category="crucible">
                    <script>writeFixedImg('../images/gallery/Events/Crucible/img5.webp', 'Optics Experiment');</script>
                </div>
                <div class="gallery-item-full" data-category="crucible">
                    <script>writeFixedImg('../images/gallery/Events/Crucible/img4.webp', 'Chladni Pattern Experiment');</script>
                </div>
                <div class="gallery-item-full" data-category="crucible">
                    <script>writeFixedImg('../images/gallery/Events/Crucible/img3.webp', 'Synchrony Workshop');</script>
                </div>
                <div class="gallery-item-full" data-category="crucible">
                    <script>writeFixedImg('../images/gallery/Events/Crucible/img1.webp', 'Crucible Physics Demo');</script>
                </div>
                <div class="gallery-item-full" data-category="crucible">
                    <script>writeFixedImg('../images/gallery/Events/Crucible/img2.webp', 'Crucible Workshop Setup');</script>
                </div>

                <!-- National Science Day -->
                <div class="gallery-item-full" data-category="national-science-day">
                    <script>writeFixedImg('../images/gallery/Events/National Science Day/img1.webp', 'National Science Day Celebration');</script>
                </div>
                <div class="gallery-item-full" data-category="national-science-day">
                    <script>writeFixedImg('../images/gallery/Events/National Science Day/img2.webp', 'Science Day Event');</script>
                </div>
                <div class="gallery-item-full" data-category="national-science-day">
                    <script>writeFixedImg('../images/gallery/Events/National Science Day/img3.webp', 'National Science Day Awards');</script>
                </div>
                <div class="gallery-item-full" data-category="national-science-day">
                    <script>writeFixedImg('../images/gallery/Events/National Science Day/img4.webp', 'Science Day Participants');</script>
                </div>
                <div class="gallery-item-full" data-category="national-science-day">
                    <script>writeFixedImg('../images/gallery/Events/National Science Day/img5.webp', 'Science Day Ceremony');</script>
                </div>
                <div class="gallery-item-full" data-category="national-science-day">
                    <script>writeFixedImg('../images/gallery/Events/National Science Day/img6.webp', 'National Science Day Group');</script>
                </div>

                <!-- Panel Discussion -->
                <div class="gallery-item-full" data-category="panel-discussion">
                    <script>writeFixedImg('../images/gallery/Events/Panel Discussion/img1.webp', 'Expert Panel Discussion');</script>
                </div>

                <!-- Cafe Scientifique -->
                <div class="gallery-item-full" data-category="cafe-scientifique">
                    <script>writeFixedImg('../images/gallery/Events/Cafe Scientifique/img1.webp', 'Cafe Scientifique Discussion');</script>
                </div>
                <div class="gallery-item-full" data-category="cafe-scientifique">
                    <script>writeFixedImg('../images/gallery/Events/Cafe Scientifique/img2.webp', 'Cafe Scientifique Session');</script>
                </div>
            </div>
        </section>
    </main>

    <div id="lightbox" class="lightbox">
        <span class="lightbox-close">&times;</span>
        <img class="lightbox-content" id="lightbox-img">
    </div>

    <footer>
        <!-- Footer content is loaded dynamically by js/script.js -->
    </footer>

    <script>writeFixedJS("../js/data.js");</script>
    <script>writeFixedJS("../js/script.js");</script>
    <script>writeFixedJS("script.js");</script>
    <script>writeFixedJS("gallery-enhanced.js");</script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // Use the same path fixing logic as other resources
                const currentHost = window.location.host;
                const currentPath = window.location.pathname;
                const isSTCDomain = currentHost === "students.iisertvm.ac.in" && currentPath.startsWith("/stc/");
                const isSubdirectoryDeployment = currentPath.includes("/STC_IISERTVM/");
                
                let swPath = '../gallery-sw.js'; // Default path
                if (isSTCDomain) {
                    swPath = '/stc/gallery-sw.js';
                } else if (isSubdirectoryDeployment) {
                    swPath = '/STC_IISERTVM/gallery-sw.js';
                }
                
                navigator.serviceWorker.register(swPath)
                    .then(registration => {
                        console.log('SW registered: ', registration);
                        
                        // Pre-cache visible images
                        if (window.galleryManager) {
                            const visibleImages = Array.from(document.querySelectorAll('.gallery-item-full img'))
                                .slice(0, 10) // Cache first 10 images
                                .map(img => img.src);
                            
                            registration.active?.postMessage({
                                type: 'CACHE_IMAGES',
                                images: visibleImages
                            });
                        }
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>

</html>
